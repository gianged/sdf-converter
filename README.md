# SDF Converter

CLI tool to extract data from SQL Server Compact Edition (`.sdf`) files and export to PostgreSQL-compatible `.sql` files.

## Why?

SQL Server CE libraries only exist for .NET Framework. No viable Rust, Node.js, or Python alternatives exist for reading `.sdf` files.

## Workflow

```
SDF file  -->  SdfConverter.exe  -->  output.sql  -->  psql  -->  PostgreSQL
```

## Features

- Export any table with all columns (dynamic schema)
- Multi-table export (separate .sql file per table)
- Streaming export for large datasets (500k+ records, constant memory usage)
- Auto-detect common attendance tables
- Support for encrypted and legacy SQL CE databases

## Usage

### Interactive Mode (Double-click)

Simply double-click `SdfConverter.exe` and follow the prompts.

```
SDF Converter - Convert SQL Server CE data to PostgreSQL SQL

Enter path to .sdf file: attendance.sdf

Available tables:
  [1] CHECKINOUT (45,230 rows)
  [2] USERINFO (500 rows)
  [3] DEPARTMENTS (12 rows)

Select table(s):
  - Enter number(s) separated by commas (e.g., 1,3,5)
  - Enter 'A' for all tables
  - Press Enter to auto-detect
Choice: 1,2

PostgreSQL schema name (default: public):

--- Exporting: CHECKINOUT (45,230 rows) ---
Exporting to: attendance_CHECKINOUT.sql
  [45230/45230] 100%
Export complete:
  Records exported: 45,230
  Output file: attendance_CHECKINOUT.sql (2.3 MB)

--- Exporting: USERINFO (500 rows) ---
...

Press any key to exit...
```

### Command Line

```bash
SdfConverter.exe <sdf-file> [options]

Options:
  --output, -o <path>    Output .sql file path (default: input.sql)
  --table, -t <name>     Table name(s) to export (can specify multiple)
  --all-tables           Export all tables from the database
  --schema <name>        PostgreSQL schema name (default: public)
  --verbose              Show detailed progress and column info
  --upgrade              Upgrade older SQL Server CE database format to 4.0
  --password, -p <pwd>   Database password for encrypted SDF files
```

### Examples

```bash
# Auto-detect attendance table
SdfConverter.exe attendance.sdf

# Export specific table
SdfConverter.exe data.sdf --table CHECKINOUT

# Export multiple tables (separate .sql file per table)
SdfConverter.exe data.sdf --table CHECKINOUT --table USERINFO

# Export ALL tables
SdfConverter.exe data.sdf --all-tables

# Custom output path and PostgreSQL schema
SdfConverter.exe data.sdf --table CHECKINOUT -o migration.sql --schema hr

# Verbose mode (shows column info)
SdfConverter.exe data.sdf --all-tables --verbose

# Older SQL CE database (v2.0/3.0/3.5) - upgrade to 4.0
SdfConverter.exe old_data.sdf --upgrade

# Password-protected database
SdfConverter.exe encrypted.sdf --password "secret123"

# Upgrade + password
SdfConverter.exe old_encrypted.sdf --upgrade --password "secret123"
```

## Output Format

Exports all columns from source table as-is:

```sql
-- Generated by SdfConverter
-- Source: attendance.sdf
-- Table: CHECKINOUT
-- Records: 45,230
-- Generated: 2024-01-15T10:30:00+07:00

INSERT INTO public.[CHECKINOUT] ([USERID], [CHECKTIME], [VERIFYCODE], [CHECKTYPE], [SENSORID])
VALUES
  (123, '2024-01-15 08:30:00', 1, 0, 1),
  (124, '2024-01-15 08:31:00', 1, 0, 1),
  ...;
```

Multiple tables generate separate files: `{sdfName}_{tableName}.sql`

## Handling Legacy Databases

### Older SQL CE Versions

SDF files created with SQL Server CE 2.0, 3.0, 3.1, or 3.5 must be upgraded to 4.0 format. Use `--upgrade` to convert automatically. A backup (`.sdf.backup`) is created before upgrading.

### Encrypted Databases

Password-protected SDF files require `--password`. In interactive mode, you'll be prompted if a password is needed.

## Performance

Uses streaming export for constant memory usage regardless of table size:

| Records | Memory Usage |
|---------|--------------|
| 10k     | ~0.5 MB      |
| 100k    | ~0.5 MB      |
| 500k    | ~0.5 MB      |
| 1M+     | ~0.5 MB      |

## Build

```bash
# Development
dotnet build

# Release - single .exe (~2.4 MB)
dotnet publish -c Release
```

Output: `bin/Release/net48/publish/SdfConverter.exe`

Copy `SdfConverter.exe` and `SdfConverter.exe.config` to your target machine.

## Import to PostgreSQL

```bash
psql -h localhost -U postgres -d mydb -f output.sql
```

## Requirements

- Windows (SQL Server CE is Windows-only)
- .NET Framework 4.8 runtime (or use self-contained build)
