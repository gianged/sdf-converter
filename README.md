# SDF Converter

CLI tool to extract historical attendance data from SQL Server Compact Edition (`.sdf`) files and export to PostgreSQL-compatible `.sql` files.

## Why?

SQL Server CE libraries only exist for .NET Framework. No viable Rust, Node.js, or Python alternatives exist for reading `.sdf` files.

## Workflow

```
SDF file  -->  SdfConverter.exe  -->  output.sql  -->  psql  -->  PostgreSQL
```

## Usage

```bash
SdfConverter.exe <sdf-file> [options]

Options:
  --output, -o <path>    Output .sql file path (default: input.sql)
  --table <name>         Attendance table name (auto-detect if omitted)
  --schema <name>        PostgreSQL schema name (default: public)
  --verbose              Show detailed progress
```

### Examples

```bash
# Auto-detect table, default output
SdfConverter.exe "C:\backup\attendance.sdf"

# Specify output and table
SdfConverter.exe "C:\backup\data.sdf" --table CHECKINOUT -o migration.sql

# Custom PostgreSQL schema
SdfConverter.exe "C:\backup\data.sdf" --schema hr --verbose
```

## Build

```bash
# Development
dotnet build

# Release (requires .NET Framework 4.8 on target)
dotnet publish -c Release

# Self-contained executable (~60-80 MB)
dotnet publish -c Release -r win-x64 --self-contained
```

## Import to PostgreSQL

```bash
psql -h localhost -U postgres -d attendance -f output.sql
```

Duplicates are handled via `ON CONFLICT DO NOTHING`. Migrated records have `source = 'sdf_migration'`.

## Requirements

- Windows (SQL Server CE is Windows-only)
- .NET Framework 4.8 runtime (or use self-contained build)

## Output Format

```sql
-- Generated by SdfConverter
-- Source: attendance.sdf
-- Table: CHECKINOUT
-- Records: 45,230

INSERT INTO public.attendance (device_uid, timestamp, verify_type, source)
VALUES
  (123, '2024-01-15 08:30:00+07', 1, 'sdf_migration'),
  (124, '2024-01-15 08:31:00+07', 1, 'sdf_migration')
ON CONFLICT (device_uid, timestamp) DO NOTHING;
```
