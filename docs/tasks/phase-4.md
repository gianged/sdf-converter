# Phase 4: SqlWriter

## Goal
Generate a PostgreSQL-compatible `.sql` file from attendance records.

## Files to Create
- `SqlWriter.cs`

---

## Purpose
Export attendance records to a SQL file that can be run via `psql`.

---

## Inputs
- Output file path
- PostgreSQL schema name (e.g., `public`, `hr`)
- Stream of `AttendanceRecord` objects
- Source metadata (sdf filename, table name, record count)

## Outputs
- `.sql` file with PostgreSQL INSERT statements
- `ExportResult` with counts

---

## Requirements

### SQL File Format
```sql
-- Generated by SdfConverter
-- Source: attendance.sdf
-- Table: CHECKINOUT
-- Records: 45,230
-- Generated: 2024-01-15T10:30:00

INSERT INTO hr.attendance (device_uid, timestamp, verify_type, source)
VALUES
  (123, '2024-01-15 08:30:00+07', 1, 'sdf_migration'),
  (124, '2024-01-15 08:31:00+07', 1, 'sdf_migration')
ON CONFLICT (device_uid, timestamp) DO NOTHING;
```
Note: `hr.attendance` uses the --schema value (defaults to `public`)

### Batching
- Group INSERT statements (e.g., 1000 values per INSERT)
- Improves readability and PostgreSQL performance

### Data Formatting
- Escape single quotes in strings
- Format timestamps as ISO 8601 with timezone
- Set `source = 'sdf_migration'` for all records

### Track Results
- Count total records written
- Report file size

### Error Cases
- Cannot write to output path: clear error message
- Invalid data: skip record, log warning

---

## Dependencies
- Phase 1 (Models) for AttendanceRecord, ExportResult
- No external NuGet packages required
